# Публікація контрактів

Це огляд того, як опублікувати вихідний код контракту в цьому репозиторії.
Для публікації контрактів, написаних на Rust, ми використовуємо стандартний реєстр Cargo [crates.io](https://crates.io/).

## Підготовка

Переконайтесь, що файл `Cargo.toml` у репо налаштований належним чином. Зокрема, бажано вибрати ім'я, що починається з `cw-`, що значно полегшить пошук контрактів CosmWasm при
пошуку на crates.io. Для першої публікації ви, напевно, захочете версію `0.1.0`.
Якщо ви вже тестували це на публічній мережі і/або проводили аудит коду,
ви можете почати з `1.0.0`, але це має свідчити про певний рівень стабільності та надійності.
У файлі `Cargo.toml` вам знадобляться записи, подібні до наведених нижче:

```toml
name = "cw-escrow"
version = "0.1.0"
description = "Simple CosmWasm contract for an escrow with arbiter and timeout"
repository = "https://github.com/confio/cosmwasm-examples"
```

Вам також потрібно буде додати дійсну [SPDX license statement](https://spdx.org/licenses/),
щоб інші знали правила використання цього сховища. Ви можете використовувати будь-яку ліцензію, навіть комерційну, але ми рекомендуємо вибрати одну з наведених нижче, якщо у вас немає специфічних вимог.

* Permissive: [`Apache-2.0`](https://spdx.org/licenses/Apache-2.0.html#licenseText) або  [`MIT`](https://spdx.org/licenses/MIT.html#licenseText)
* Copyleft: [`GPL-3.0-or-later`](https://spdx.org/licenses/GPL-3.0-or-later.html#licenseText) або [`AGPL-3.0-or-later`](https://spdx.org/licenses/AGPL-3.0-or-later.html#licenseText)
* Комерційна ліцензія: `Commercial` (не впевнений, чи це працює, я не можу знайти приклади)

Також корисно завантажити текст ЛІЦЕНЗІЇ (посилання вище) і зберегти його у файлі LICENSE у вашому репозиторії. Тепер ви правильно налаштували своє сховище для використання
у великій екосистемі.

### Оновлення схеми

Щоб полегшити використання контракту, ми можемо опублікувати схему (`schema/*.json`) разом
з вихідним кодом.

```sh
cargo schema
```

Переконайтесь, що ви перевірили всі файли схеми, та зробили git commit з остаточним станом.
Цей комміт буде опубліковано, і його слід позначити. Зазвичай ви хочете позначити версію (наприклад, `v0.1.0`), але в репозиторії `cosmwasm-examples` у нас є кілька контрактів, і ми позначаємо його як `escrow-0.1.0`. Не забудьте про
`git push && git push --tags`

### Примітка щодо результатів збірки

Результати збірки, як-то байт-код Wasm або очікуваний хеш, не потребують оновлення, оскільки вони не входять до публікації вихідного коду. Однак, вони виключені з пакування
у `Cargo.toml`, що дозволяє вам вносити їх до вашого репозиторію git, якщо ви бажаєте.

```toml
exclude = ["artifacts"]
```

Один вихідний код може бути зібраний за допомогою декількох різних оптимізаторів, тому ми не повинні робити жодних строгих припущень про інструменти, які будуть використовуватися.

## Публікація

Тепер, коли ваш пакет правильно налаштовано і всі артефакти виявлено, настав час поділитися ним зі світом.
Будь ласка, зверніться до [повної інструкції для будь-яких питань](https://rurust.github.io/cargo-docs-ru/crates-io.html),
але я спробую дати короткий огляд успішного шляху тут.

### Реєстр

Вам знадобиться обліковий запис на [crates.io](https://crates.io) для публікації crate rust.
Якщо у вас його ще немає, просто натисніть "Log in with GitHub" в верхньому правому куті, щоб швидко налаштувати безкоштовний обліковий запис. Після входу натисніть на своє ім'я користувача (вгорі справа), потім "Account Settings". Внизу є розділ, що називається "API Access".
Якщо у вас це ще не налаштовано, створіть новий токен і використовуйте `cargo login`
щоб встановити його. Це тепер аутентифікує вас з інструментом cli `cargo` і дозволить
вам публікувати.

### Завантаження

Після налаштування переконайтеся, що ви закомітили поточний стан, який хочете опублікувати.
Потім спробуйте `cargo publish --dry-run`. Якщо все пройшло добре, перегляньте файли, які будуть опубліковані через `cargo package --list`. Якщо ви задоволені, ви тепер можете офіційно опублікувати його через `cargo publish`.

Вітаємо, ваш пакет тепер доступний для всього світу.

### Поширення

Після того, як ви опублікували свій пакет, люди тепер можуть знайти його шляхом
[пошуку "cw-" на crates.io](https://crates.io/search?q=cw).
Але це не самий простий спосіб. Щоб полегшити речі та допомогти
зберігати цілісність екосистеми, ми рекомендуємо зробити PR, щоб додати ваш пакет
до списку [`cawesome-wasm`](https://github.com/cosmwasm/cawesome-wasm).

### Організації

Часто ви пишете контракт не як самостійний розробник, а як
частина організації. Ви захочете дозволити колегам завантажувати нові
версії контракту на crates.io, коли ви будете у відпустці.
[Ці інструкції показують, як]() ви можете налаштувати свій crate так, щоб у ній могли працювати декілька розробників.

Ви можете додати іншого власника до crate, вказавши їх користувача github. Зверніть увагу, ви тепер обидва матимете повний контроль над crate, і вони можуть видалити вас:

`cargo owner --add ethanfrey`

Ви також можете додати існуючу команду github у свою організацію:

`cargo owner --add github:confio:developers`

Команда дозволить будь-кому, хто зараз у команді, публікувати нові версії crate.
І він автоматично оновлюється, коли ви вносите зміни на github. Однак, це не дозволить будь-кому в команді додавати або видаляти інших власників.
